<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hacker Birthday Mission</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:black;
  color:#00ff9c;
  font-family:Courier New, monospace;
  overflow:hidden;
}
canvas{position:fixed;inset:0;z-index:0}
.screen{
  display:none;
  min-height:100vh;
  padding:24px;
  position:relative;
  z-index:2;
}
.active{display:block}
input,textarea,button{
  width:100%;
  margin:10px 0;
  padding:12px;
  background:black;
  border:1px solid #00ff9c;
  color:#00ff9c;
  font-family:inherit;
}
button:hover{background:#00ff9c;color:black;cursor:pointer}
h1,h2{text-shadow:0 0 10px #00ff9c}
.typing{white-space:pre-line}
.progress{height:8px;background:#003322;margin-top:12px}
.bar{height:100%;width:0%;background:#00ff9c;transition:.4s}
.lock{color:red;text-align:center;margin-top:40px}
</style>
</head>

<body>
<canvas id="matrix"></canvas>

<!-- CREATE -->
<div class="screen active" id="create">
  <h1>ðŸŽ‚ CREATE HACKER BIRTHDAY</h1>
  <input id="name" placeholder="Target Name">
  <input id="dob" type="date">
  <textarea id="wish" placeholder="Secret birthday wish..."></textarea>
  <button id="btnCreate">GENERATE SECRET LINK</button>
  <p id="output"></p>
</div>

<!-- HACK -->
<div class="screen" id="hack">
  <h2>UNAUTHORIZED ACCESS</h2>
  <div class="typing" id="hackText"></div>
  <div class="progress"><div class="bar" id="hackBar"></div></div>
</div>

<!-- GAME -->
<div class="screen" id="game">
  <h2 id="gameTitle"></h2>
  <p id="gameDesc"></p>
  <h1 id="gameQuestion"></h1>
  <div id="gameChoices"></div>
  <div class="progress"><div class="bar" id="gameBar"></div></div>
</div>

<!-- LOCK -->
<div class="screen" id="locked">
  <h1>ðŸ”’ ACCESS LOCKED</h1>
  <p class="lock">Misi ini hanya boleh dibuka pada hari jadi sasaran ðŸŽ‚</p>
</div>

<!-- FINAL -->
<div class="screen" id="final">
  <h1 id="finalTitle"></h1>
  <p id="finalMsg"></p>
</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, getDoc, deleteDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnsq6HINc_utsrxa__taeBHHdtIrCM04c",
  authDomain: "hacker-birthday.firebaseapp.com",
  projectId: "hacker-birthday"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= MATRIX ================= */
const c=document.getElementById("matrix"),ctx=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;
const chars="01HACKBIRTHDAY",font=14;
const drops=Array(Math.floor(c.width/font)).fill(1);
setInterval(()=>{
  ctx.fillStyle="rgba(0,0,0,.05)";
  ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle="#00ff9c";
  ctx.font=font+"px monospace";
  drops.forEach((y,i)=>{
    ctx.fillText(chars[Math.random()*chars.length|0],i*font,y*font);
    if(y*font>c.height&&Math.random()>.975)drops[i]=0;
    drops[i]++;
  });
},50);

/* ================= HELPERS ================= */
const show=id=>{
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

const age=d=>{
  const b=new Date(d),t=new Date();
  let a=t.getFullYear()-b.getFullYear();
  if(t.getMonth()<b.getMonth()||(
    t.getMonth()===b.getMonth()&&t.getDate()<b.getDate()
  ))a--;
  return a;
};

const vibrate=ms=>navigator.vibrate&&navigator.vibrate(ms);

/* ================= SOUND ================= */
const success=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const fail=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

/* ================= CREATE ================= */
btnCreate.onclick=async()=>{
  if(!name.value||!dob.value||!wish.value)return alert("Lengkapkan semua");
  const ref=await addDoc(collection(db,"missions"),{
    Name:name.value,DOB:dob.value,Wish:wish.value
  });
  output.innerHTML=`ðŸ”— <b>${location.origin+location.pathname+"#"+ref.id}</b>`;
};

/* ================= LOAD ================= */
const id=location.hash.replace("#","");
let DATA=null;
if(id){
  const snap=await getDoc(doc(db,"missions",id));
  if(!snap.exists())return;
  DATA=snap.data();
  const today=new Date();
  const dobDate=new Date(DATA.DOB);
  if(today.getDate()!==dobDate.getDate()||today.getMonth()!==dobDate.getMonth()){
    show("locked");return;
  }
  startHack();
}

/* ================= HACK ================= */
const lines=["Intercepting signal...","Decrypting payload...","Bypassing firewall...","Injecting birthday.exe...","ACCESS GRANTED"];
let i=0;
function startHack(){
  show("hack");
  const iv=setInterval(()=>{
    hackText.textContent+=lines[i]+"\n";
    hackBar.style.width=((i+1)/lines.length*100)+"%";
    if(++i===lines.length){
      clearInterval(iv);
      setTimeout(startGame,800);
    }
  },600);
}

/* ================= GAMES ================= */
let step=0;
const questions=[
  {q:"2 + 3 Ã— 2 = ?",c:["10","8","12"],a:1},
  {q:"Tujuan misi ini?",c:["Hack bank","Raikan hari jadi ðŸŽ‰","Shutdown"],a:1},
  {q:"Aku berjalan tanpa kaki, bercakap tanpa suara",c:["Api","Jam","Angin"],a:1},
  {q:"5Â² = ?",c:["10","20","25"],a:2},
  {q:"Apa simbol birthday?",c:["ðŸŽ‚","ðŸ’£","ðŸ§ "],a:0}
];

function startGame(){
  show("game");
  loadGame();
}

function loadGame(){
  const q=questions.sort(()=>0.5-Math.random())[0];
  gameTitle.textContent="SECURITY LAYER "+(step+1);
  gameDesc.textContent="Selesaikan untuk teruskan misi";
  gameQuestion.textContent=q.q;
  gameChoices.innerHTML="";
  gameBar.style.width=((step)/3*100)+"%";

  q.c.forEach((txt,i)=>{
    const b=document.createElement("button");
    b.textContent=txt;
    b.onclick=async()=>{
      if(i===q.a){
        success.play();vibrate(200);
        if(++step<3)loadGame();
        else{
          await deleteDoc(doc(db,"missions",id));
          showFinal();
        }
      }else{
        fail.play();vibrate(600);
        location.reload();
      }
    };
    gameChoices.appendChild(b);
  });
}

/* ================= FINAL ================= */
function showFinal(){
  show("final");
  const a=age(DATA.DOB);
  finalTitle.textContent="ðŸŽ‰ SELAMAT HARI JADI "+DATA.Name.toUpperCase()+" ðŸŽ‰";
  finalMsg.innerHTML=`
    <b>Yang ke ${a}!!</b> ðŸ¥³<br><br>
    ${DATA.Wish}<br><br>
    <b>Status:</b> MISSION COMPLETE
  `;
}
</script>
</body>
</html>
